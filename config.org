* é»˜è®¤æŠ˜å ä»£ç 

#+OPTIONS: num:nil \n:t ;; å¯¼å‡ºæ–‡æ¡£æ—¶æ˜¯å¦æ˜¾ç¤ºç« èŠ‚ç¼–å·
#+STARTUP: nofold ;; æ‰“å¼€æ–‡æ¡£æ—¶æ˜¯å¦æŠ˜å å¤§çº²
#+STARTUP: hideblocks ;; æ‰“å¼€æ–‡æ¡£æ—¶æ˜¯å¦éšè—ä»£ç å—

* æ‰“å¼€é…ç½®æ–‡ä»¶

C-c I

#+begin_src emacs-lisp
  (defun find-config ()
    "Edit config.org"
    (interactive)
    (find-file (expand-file-name "config.org" (expand-file-name user-emacs-directory))))
  (global-set-key (kbd "C-c I") 'find-config)
#+end_src

* é‡æ–°åŠ è½½é…ç½®

C-c R

#+begin_src emacs-lisp
  (defun reload-config ()
    "Reload config"
    (interactive)
    (delete-file (expand-file-name "config.el" (expand-file-name user-emacs-directory)))
    (org-babel-load-file (expand-file-name
			  "config.org"
			  (expand-file-name user-emacs-directory))))
  (global-set-key (kbd "C-c R") 'reload-config)
#+end_src

* åŒ…ç®¡ç†

emacs 29 å·²ç»é›†æˆäº† use-package
#+begin_src emacs-lisp
  ;; (use-package avy)
  ;; (use-package avy :ensure t)
#+end_src

ç¼ºç‚¹: ä¸å¤Ÿçµæ´», åªèƒ½å®‰è£…æŒ‡å®šæºçš„å›ºå®šç‰ˆæœ¬çš„åŒ…

#+begin_src emacs-lisp
  (defvar bootstrap-version)
  (let ((bootstrap-file
	 (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
	(bootstrap-version 6))
    (unless (file-exists-p bootstrap-file)
      (with-current-buffer
	  (url-retrieve-synchronously
	   "https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el"
	   'silent 'inhibit-cookies)
	(goto-char (point-max))
	(eval-print-last-sexp)))
    (load bootstrap-file nil 'nomessage))
  ;;; Integration with use-package
  (straight-use-package 'use-package)

  (setq straight-use-package-by-default t)
  (setq straight-vc-git-default-clone-depth 1)

  (use-package beacon
    :straight t)
#+end_src

* ä¸»é¢˜
#+begin_src emacs-lisp
  (use-package kaolin-themes
    :straight t)
#+end_src

* åˆ‡æ¢ä¸»é¢˜
#+begin_src emacs-lisp
  (setq-default custom-enabled-themes '(kaolin-galaxy))

  (defun reapply-themes ()
    "Forcibly load the themes listed in `custom-enabled-themes'."
    (dolist (theme custom-enabled-themes)
      (unless (custom-theme-p theme)
	(disable-theme theme)
	(load-theme theme)))
    (custom-set-variables `(custom-enabled-themes (quote , custom-enabled-themes))))

  (add-hook 'after-init-hook 'reapply-themes)

  (defun theme-light ()
    "Activate a light color theme."
    (interactive)
    (setq custom-enabled-themes '(kaolin-light))
    (reapply-themes))

  (defun theme-dark ()
    "Activate a dark color theme."
    (interactive)
    (setq custom-enabled-themes '(kaolin-galaxy))
    (reapply-themes))
#+end_src

* è®¾ç½®ä¸“é—¨çš„ cutstom.el æ¥å­˜æ”¾ç”Ÿæˆçš„é…ç½®æ–‡ä»¶

è®©è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ”¾åˆ°ä¸“é—¨çš„é…ç½®æ–‡ä»¶ä¸­, é˜²æ­¢æ±¡æŸ“ init.el

#+begin_src emacs-lisp
  (setq custom-file (expand-file-name "custom.el" user-emacs-directory))
  (load custom-file)
#+end_src

* ä½¿ç”¨ y or n æ¥å›ç­”

é»˜è®¤æ˜¯ yes or no æ¥è¡¨ç¤º ç¡®è®¤/å–æ¶ˆ.

#+begin_src emacs-lisp
  (setq-default use-short-answers t)
#+end_src

æ³¨æ„è¾ƒè€ç‰ˆæœ¬ emacs, æ˜¯ `(defalias 'yes-or-no-p 'y-or-n-p)`

è¿™ä¹Ÿæ˜¯ç”¨ä¾‹æ–‡æ¡£é©±åŠ¨çš„å¥½å¤„, éœ€æ±‚æ˜¯ä¸å˜çš„, ä½†æ˜¯å®ç°(é…ç½®ä»£ç )ä¼šå˜.

* ä¸è¦ç”Ÿæˆå¤‡ä»½æ–‡ä»¶

emacs ä¼šç”Ÿæˆ #xxx# å’Œ xxx~ è¿™æ ·çš„å†å²å¤‡ä»½æ–‡ä»¶

ä¸€èˆ¬çš„æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶å’Œ undo æœºåˆ¶å·²ç»è¶³å¤Ÿ

#+begin_src emacs-lisp
  (setq make-backup-file nil)
  (setq auto-save-default nil)
  (setq backup-inhibited t)
  (setq backup-directory-alist `(("." . "~/.cache/.saves")))
#+end_src

* ç²¾ç®€ UI, æ‰©å¤§å¯è§†é¢ç§¯

ä¸è¦å·¥å…·æ , ä¸è¦æ»šåŠ¨æ¡, ä¸è¦èœå•æ 

#+begin_src emacs-lisp
  (tool-bar-mode -1)
  (scroll-bar-mode -1)
  (menu-bar-mode -1)
#+end_src

* è‡ªåŠ¨æ¢å¤ buffer

ç°ä»£åŒ–çš„æ–‡æœ¬ç¼–è¾‘å™¨åœ¨æ£€æµ‹åˆ°æ–‡ä»¶å› ä¸ºåˆ«çš„åŸå› è¢«ä¿®æ”¹æ—¶éƒ½ä¼šè¿›è¡ŒåŒæ­¥.

#+begin_src emacs-lisp
  (global-auto-revert-mode t)
#+end_src

* å½“é€€å‡ºæ—¶, æ›´å‹å¥½çš„æç¤ºæœªä¿å­˜çš„æ–‡ä»¶

#+begin_src emacs-lisp
  (defun clean-exit ()
    "Exit Emacs cleanly. If there are unsaved buffer, pop up a list for them to be saved before existing.
  Replaces 'save-buffers-kill-terminal'."
    (interactive)
    (if (frame-parameter nil 'client)
	(server-save-buffers-kill-terminal arg)
      (if-let ((buf-list (seq-filter (lambda (buf)
				       (and (buffer-modified-p buf)
					    (buffer-file-name buf)))
				     (buffer-list))))
	  (progn
	    (pop-to-buffer (list-buffers-noselect t buf-list))
	    (message "s to save, C-k to kill, x to execute"))
	(save-buffers-kill-emacs))))

  (global-set-key (kbd "C-x C-c") 'clean-exit)
#+end_src

* æ‰“å¼€æ–‡ä»¶
** é€‰å®šæ–‡ä»¶å¹¶æ‰“å¼€
|-----------+-------------------------------------|
| C-x C-f   | å½“å‰çª—å£æ‰“å¼€æ–‡ä»¶                       |
| C-x 4 f   | åœ¨å…¶ä»–çª—å£æ‰“å¼€æ–‡ä»¶                     |
| C-x 4 C-o | åœ¨å…¶ä»–çª—å£æ˜¾ç¤ºä¸€ä¸ª buffer              |
| C-x 4 b   | åˆ‡æ¢å¦ä¸€ä¸ªçª—å£çš„ buffer å¹¶ä¸”æ¿€æ´»é‚£ä¸ªçª—å£ |
| C-x 5 f   | åœ¨æ–° frame ä¸­æ‰“å¼€æ–‡ä»¶                  |
| C-x C-r   | åœ¨å½“å‰çª—å£ä»¥åªè¯»å½¢å¼æ‰“å¼€æ–‡ä»¶             |
| C-x 4 r   | åœ¨å…¶ä»–çª—å£ä»¥åªè¯»å½¢å¼æ‰“å¼€æ–‡ä»¶             |

** å¿«é€Ÿæ‰“å¼€ç‰¹å®šæ–‡ä»¶
ä½¿ç”¨ ~C-x r m~ æŠŠå½“å‰æ–‡ä»¶è®¾ç½®ä¸ºä¹¦ç­¾ï¼Œä¹‹åå°±èƒ½ä½¿ç”¨ ~C-x r b~ è·³è½¬åˆ°è¯¥ä¹¦ç­¾ã€‚

ä¸´æ—¶è®°å½•ç‰¹å®šæ–‡ä»¶å¯ä»¥ä½¿ç”¨ ~C-x r space~ æ¥å°†å½“å‰ä½ç½®ä¿å­˜åˆ°æŒ‡å®šå¯„å­˜å™¨ä¸­ï¼Œä¹‹åä½¿ç”¨ ~C-x r j~ è·³åˆ°æŒ‡å®šå¯„å­˜å™¨æ‰€åœ¨çš„ä½ç½®ï¼Œæ³¨æ„å…³é—­ emacs åè®°å½•ä¼šæ¶ˆå¤±ã€‚

* ä¿å­˜æ–‡ä»¶

|---------+--------------|
| C-x C-s | ä¿å­˜å½“å‰æ–‡ä»¶ |
| C-x s   | ä¿å­˜æ‰€æœ‰æ–‡ä»¶ |

* åœ¨æ–°çš„ frame ä¸­æ‰“å¼€å¾…åŠäº‹é¡¹åˆ—è¡¨æ–‡ä»¶

#+begin_src emacs-lisp
  (defun find-todo-list()
    "Open todo.org in other frame"
    (interactive)
    (if (not (equal (buffer-file-name) (file-truename "~/e/todo.org")))
	(find-file-other-frame "~/e/todo.org")))

  (global-set-key (kbd "C-c t") 'find-todo-list)
#+end_src

* æ‰“å¼€(é•¿)æ–‡ä»¶å¹¶å·¦å³åˆ†å±æ˜¾ç¤ºå¹¶å¯ç”¨ follow mode

#+begin_src emacs-lisp
  (defun find-file-side-by-side()
    "Open file side by side with follow mode enabled"
    (interactive)
    (setq filename (read-file-name "Choose a file: "))
    (message "Selected file: %s" filename)
    (find-file filename)
    (split-window-horizontally)
    (follow-mode))

  (global-set-key (kbd "C-c s") 'find-file-side-by-side)
#+end_src

* æ‰“å¼€å¹¶ç›‘æ§ zsh shell çš„æ“ä½œå†å²

#+begin_src emacs-lisp
  (defun tail-zsh-history()
    "tail zsh history log"
    (interactive)
    (find-file "~/.local/state/zsh/.histfile")
    (end-of-buffer)
    (auto-revert-tail-mode))
#+end_src

* æ‰“å¼€ buffer å†…å®¹ä¸­æŒ‡å‘çš„æ–‡ä»¶
~find-file-at-point~
e.g ~/.local/state/zsh/.histfile

* æ‰“å¼€å‰ªåˆ‡æ¿çš„å†…å®¹å¹¶å°†å…¶ä½œä¸ºè·¯å¾„

#+begin_src emacs-lisp
  (defun find-file-at-clipboard()
    "Find file at clipboard path."
    (interactive)
    (with-temp-buffer
      (clipboard-yank)
      (find-file-at-point)))

  (global-set-key (kbd "C-c f") 'find-file-at-clipboard)
#+end_src

* å…¨å±€è®¾ç½®è‡ªåŠ¨ä¿å­˜

#+begin_src emacs-lisp
  (auto-save-visited-mode)
#+end_src

* åˆ‡æ¢çª—å£
** åˆ‡æ¢åˆ°æŒ‡å®šçª—å£

~M-o~ ç„¶åæŒ‰ä¸‹çª—å£å·¦ä¸Šè§’æ˜¾ç¤ºçš„å¯¹åº”å­—æ¯ (a r s t d t h n e i o)
#+begin_src emacs-lisp
  (use-package ace-window
    :config
    (setq aw-keys '(?a ?r ?s ?t ?d ?h ?n ?e ?i ?o))
    (custom-set-faces
     '(aw-leading-char-face
       ((t (:inherit ace-jump-face-foreground :height 2.0)))))
    :bind
    ("M-o" . ace-window))
#+end_src

** æ¢å¤çª—å£å¸ƒå±€

~C-c <left-arrow> <right-arrow>~ æ¥æ¢å¤æ’¤é”€ä¹‹å‰çš„çª—å£å¸ƒå±€

#+begin_src emacs-lisp
  (use-package winner-mode
    :straight nil
    :hook
    (after-init . winner-mode))
#+end_src

*** é‡å¯åæ¢å¤

#+begin_src
  (desktop-save-mode 1)
#+end_src

* Buffer ä¸­ç§»åŠ¨å…‰æ ‡

| C-b | å·¦ç§»å­—ç¬¦ |
| C-f | å³ç§»å­—ç¬¦ |

| M-b | å·¦ç§»å•è¯ |
| M-f | å³ç§»å•è¯ |

| C-a | ç§»åŠ¨åˆ°è¡Œé¦– |
| C-e | ç§»åŠ¨åˆ°è¡Œå°¾ |
| C-n | ç§»åŠ¨ä¸‹ä¸€è¡Œ |
| C-p | ç§»åŠ¨ä¸Šä¸€è¡Œ |

| M-<   | ç§»åŠ¨åˆ° buffer å¤´éƒ¨    |
| M->   | ç§»åŠ¨åˆ° buffer å°¾éƒ¨    |
| M-g g | ç§»åŠ¨åˆ° buffer ä¸­æŒ‡å®šè¡Œ |
| C-v   | å‘ä¸‹æ»šåŠ¨              |
| M-v   | å‘ä¸Šæ»šåŠ¨              |

| C-M-v   | å…¶ä»– buffer å‘ä¸Šæ»šåŠ¨ |
| C-M-S-v | å…¶ä»– buffer å‘ä¸‹æ»šåŠ¨ |

| C-s | å‘ä¸‹æœç´¢ |
| C-r | å‘ä¸Šæœç´¢ |

* è®¾ç½®æ ‡è®°

| C-SPC       | ç„¶åç§»åŠ¨å…‰æ ‡    |
| shift + ç§»åŠ¨ | è‡ªåŠ¨ mark      |
| C-x         | é€‰å®šæ•´ä¸ª buffer |

* ç¼–è¾‘å†…å®¹
+ ç›´æ¥è¾“å…¥å†…å®¹
+ å¿«é€Ÿè¾“å…¥å†…å®¹
+ çŸ©å½¢ç¼–è¾‘
+ è¾“å…¥ emoji

** å¿«é€Ÿè¾“å…¥å†…å®¹
*** Abbrev
é€‰ä¸­è¦ç”¨ä½œæ‰©å±•çš„è¯ï¼Œç„¶åé”®å…¥ C-x a gä»¥åŠå®ƒçš„ç¼©å†™

ç„¶åä¹‹åè¾“å…¥ç¼©å†™, åœ¨ç¼©å†™ä¹‹å é”®å…¥ C-x a ' è‡ªåŠ¨æ‰©å±•
#+begin_src emacs-lisp
  (setq abbrev-file-name (expand-file-name "abbrev_defs" user-emacs-directory))
  (setq save-abbrevs 'silently) ;; save abbrevs when file are saved
#+end_src

*** Dynamic Abbrev

~M+/~ è¾“å…¥éƒ¨åˆ†, emacs ä¼šæ ¹æ® buffer å·²æœ‰çš„å†…å®¹è‡ªåŠ¨è¡¥å…¨ä¸€ä¸ªå•è¯

** çŸ©å½¢ç¼–è¾‘

~C-x SPC~ æŠŠ region è½¬æ¢ä¸º Rectangles ~C-x r t~ æ›¿æ¢çŸ©å½¢æ–‡æœ¬

hello world
hello world
hello world

** è¾“å…¥ Emoji

~C-x 8 C-h~
~C-x 8 RET~
ğŸ‘¨

* è‡ªå®šä¹‰ modeline

ä¿ç•™äº†ä¸€éƒ¨åˆ†å¸¸ç”¨çš„ä¿¡æ¯ (buffer åç§°, ç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯, æ˜¯å¦åªè¯», æ˜¯å¦è¢«ç¼–è¾‘è¿‡)

#+begin_src emacs-lisp
  (setq mode-line-format
     '("%e"
       mode-line-front-space
       (:propertize
	(""
	 mode-line-mule-info
	 mode-line-client
	 mode-line-modified
	 mode-line-remote)
	display
	(min-width
	 (5.0)))
       mode-line-frame-identification
       mode-line-buffer-identification
       "   "
       mode-line-position
       (vc-mode vc-mode)
       "  "
       mode-line-modes
       mode-line-misc-info
       mode-line-end-spaces
       ))
#+end_src

è¿˜åŠ ä¸Šäº†å¯çˆ±çš„å½©è™¹çŒ«å’ªæ¥æ˜¾ç¤ºå…‰æ ‡åœ¨ buffer ä¸­çš„å¤§æ¦‚ä½ç½®ã€‚

#+begin_src emacs-lisp
  (use-package nyan-mode
    :init
    (setq nyan-animate-nyancat t)
    (setq nyan-wavy-trail t)
    (setq nyan-minimum-window-width 80)
    (setq nyan-bar-length 20)
    (nyan-mode))
#+end_src


** å¸¸è§å‡½æ•°

 | mode-line-front-space           | Dash (-) for text terminals, a space ( ) for graphic displays              |
 | mode-line-mule-info             | Information on character sets, encodings, and other human-language details |
 | mode-line-client                | Identifies frames created by emacsclient                                   |
 | mode-line-modified              | Modified and read-only status                                              |
 | mode-line-remote                | At-sign (@) for buffers visiting remote files, otherwise a dash            |
 | mode-line-frame-identification  | Frame title, for some environments                                         |
 | mode-line-buffer-identification | Buffer/file name                                                           |
 | mode-line-position              | Line, column, and portion (percent) of point in buffer; total size         |
 | mode-line-modes                 | Major and minor modes, in parenthesis; square brackets if RecursiveEdit    |
 | mode-line-misc-info             | Defun name for â€˜which-function-modeâ€™, clock for â€˜display-time-modeâ€™        |
 | mode-line-end-spaces            | A line of dashes for text terminals; nothing for graphics displays         |

* Minibuffer
** Minibuffer ä¹Ÿæ˜¯ buffer

buffer ä¸­çš„è®¸å¤šæ“ä½œä¹Ÿå¯ä»¥åœ¨ minibuffer ä¸­ä½¿ç”¨

æ¢è¡Œ ~C-q C-j~

** Minibuffer ä¸ä¸€å®šæ˜¯ buffer

å½“ç”¨äºæ˜¾ç¤ºæ¶ˆæ¯æ—¶, å…¶è¢«ç§°ä½œ EchoArea.

(message "call me echo area")

** è‡ªåŠ¨è¡¥å…¨

IDO - Interactively DO things

#+begin_src emacs-lisp
  (setq ido-enable-flex-matching t)
  (setq ido-everywhere t)
  (ido-mode 1)
#+end_src

* BDD
Behavior-driven development  è¡Œä¸ºé©±åŠ¨å¼€å‘

** Emacs lisp ä¸­çš„ BDD
+ ecukes https://github.com/ecukes/ecukes
+ espuds https://github.com/ecukes/espuds
+ eask   https://github.com/emacs-eask

** é…ç½®ç¯å¢ƒ

*** å®‰è£… eask
#+begin_src shell
  yarn global add emacs-eask/cli
#+end_src
*** åˆå§‹åŒ– eask
#+begin_src shell
  eask init
#+end_src

*** æ·»åŠ  ecukes å’Œ espuds çš„ä¾èµ–

#+begin_comment
(package "pratice-emacs"
"1.0.0"
"Document Driven Development")

(website-url "https://zweisamkeiten.github.io/emacs-pratice/")
(keywords "bdd")

(files "pratice-emacs.el")

(script "test" "echo \"Error: no test specified\" && exit 1")

(source "gnu")
(source "melpa")

(depends-on "emacs" "30.0")
(depends-on "ecukes")
(depends-on "espuds")
#+end_comment

*** åˆå§‹åŒ–æµ‹è¯•æ–‡ä»¶

#+begin_src shell
  eask exec ecukes new
#+end_src

** ç¼–å†™æµ‹è¯•å’Œå®šä¹‰æ­¥éª¤

*** ç¼–å†™æµ‹è¯•
#+begin_src feature
Feature: Emacs

  Scenario: OpenConfigFile
    Given I am in buffer "*scratch*"
    When I press "C-c I"
    Then I should be in buffer "config.org"
#+end_src

*** å®šä¹‰æ­¥éª¤
https://github.com/ecukes/espuds/blob/master/espuds.el#L131-L143

https://github.com/ecukes/espuds/blob/master/espuds.el#L290-L291

*** æ‰§è¡Œæµ‹è¯•
#+begin_src shell
  eask run test
#+end_src

* Elegant Markup æ ‡è®°

** æ’å…¥åŒçº§åˆ« heading æ ‡é¢˜

~C-RET~ åœ¨å½“å‰æ ‡é¢˜ä»¥åŠæ‰€æœ‰å†…å®¹ä¹‹åæ’å…¥ä¸€ä¸ªåŒçº§æ–°æ ‡é¢˜
~M-RET~ åœ¨å½“å‰æ ‡é¢˜æˆ–å†…å®¹åç›´æ¥æ’å…¥ä¸€ä¸ªåŒçº§æ–°æ ‡é¢˜

** è°ƒæ•´å’Œé€’å½’è·³è½¬æ ‡é¢˜ heading å±‚çº§

~M-<LEFT>~ å’Œ ~M-<RIGHT>~

~M-S-<LEFT>~ å’Œ ~M-S-<RIGHT>~

** ç§»åŠ¨æ ‡é¢˜ heading

~M-<UP>~ å’Œ ~M-<DOWN>~

è¿å¸¦ç€æ ‡é¢˜ä»¥åŠå†…å®¹ç§»åŠ¨

** åˆ—è¡¨

- æ— åºåˆ—è¡¨ :: ä½¿ç”¨ + æˆ– - å¼€å¤´
- æœ‰åºåˆ—è¡¨ :: ä½¿ç”¨ 1. æˆ– 1) å¼€å¤´

  ~M-RET~ ä¼šè‡ªåŠ¨æ’å…¥åˆ—è¡¨æ–°é¡¹

** å—

~#+begin_xxx ... #+end_xxx~

- src
- example
- quote

*** å¿«é€Ÿè¾“å…¥å—

å¿«æ·é”® ~C-c C-,~ åŠ ä¸Šå¯¹åº”å­—æ¯

** å­—ä½“

- ~*ç²—ä½“*~
- ~/æ–œä½“/~
- ~+åˆ é™¤çº¿+~
- ~_ä¸‹åˆ’çº¿_~

*hello*
/hello/
+hello+
_hello_

*** å¿«é€Ÿæ·»åŠ å­—ä½“
#+begin_src emacs-lisp
  (use-package wrap-region
    :straight t
    :config
    (wrap-region-add-wrappers
     '(("*" "*" nil org-mode)
       ("~" "~" nil org-mode)
       ("/" "/" nil org-mode)
       ("_" "_" nil org-mode)))
    (add-hook 'org-mode-hook 'wrap-region-mode))
#+end_src

é€‰ä¸­éœ€è¦åŒ…å›´çš„è¯ è¾“å…¥ ~*~ æˆ–è€…å…¶ä»–, å°±ä¼šåœ¨å‰åæ·»åŠ 
